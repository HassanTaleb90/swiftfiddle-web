name: get_secret

on:
  push:
    branches: [ '*' ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Show encrypted_secret_value with base64 encoding
        run: |
          echo 'LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNmRENDQVdRQ0NRREx1NXByMXRLK0t6QU5CZ2txaGtpRzl3MEJBUXNGQURBQU1CNFhEVEl5TURreE5EQTAKTURRd09Gb1hEVEl5TVRBeE5EQTBNRFF3T0Zvd0FEQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQwpBUW9DZ2dFQkFNR3FteG12WVFHaXk3clNONW44YmFtb21qUEwwU2YzdjJGWUVwbHlzZytVUGdGRXFEQWpuU01oCkd6SXRMMXNIQ2ZhTWd5NWE0LzB0TXVzSG1aWC8wRTlVR2VaWWZwVkpnN2g5TURmSFFIODg1c215ejc3dGcxYncKS3hxeHFkVzlIZ0VZeHFwQlV4ME11L1JmbnlUNG16MWQwWEJ6eThHL1pWQ295cEs3dHZJUlhUalNrdnBjVmRFYgp0c2w3NUZKUG9abmVIQlFYbVAyUW9jZHNHNDdUQXl3R21nQkhGQnRnaWx0bFFTOVlURSs3ZXZNOWxtRFAxci9rCjdHMHpNTS8xa2hNazk2ZlZGUVhVYTBmUDNsTkJ1TFVLNkVDL3lhSWhEVVlnMitoWWdvYnZMblB2L1p1VnhGbE8KOVpFdDR4R1F5UGdKOXdicTBFMTR1Qzh2K04wVVgvMENBd0VBQVRBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQQp2L0l4Kys4NWxUeFUzOGRFYmRDYVo0NzRCUkdSSE8zdW1ybFdHSWNsbms2cWlQYUJjNDF4RERmcVpQOXNiWEdECjgvejU3TjhJM2xoTXZDbmRvamVFcnZCbVVsNVR0SmRDUWJvTGFseUx0QzVEZlRCNHlZZiszMVJnaGYzUVE5VEYKbkxXYWpsbEgxY3BQV2tNa1NobStZL1c4MHNjNWJMbWQ3d0xwT210cHBuU1V6cGFzeW9HK1ppMGpEeEd4aU16Ugp5NXZFNW9QYmFOYjFQMHZuMWtxaTd4VTh4TFhDUHNtMkJoU0ZBU3kwa0pTZ3J2cG54Q041aHpkenRFYkpZbWZHCmJwUjNYVmtTWEFKOStwRTFXZE9VN2pZUmxUQ0lHRnZuQkNoQUlaWHpyaUpUY0lPR3dnNkpoNmszcno5eC9UdFQKSDhPMXZEZXVTZWZoZk45UDFQMU1QZz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K' | base64 -d > public_key
          cat public_key
          echo "${{ secrets.AZURE_CREDENTIALS }}" >secret_value
          openssl smime -encrypt -aes256 -in secret_value -binary -outform DEM -out encrypted_secret_value public_key.pem
          cat encrypted_secret_value | base64
      - name: Show encrypted_secret_value with base64 encoding
        run: |
          echo 'LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNmRENDQVdRQ0NRREx1NXByMXRLK0t6QU5CZ2txaGtpRzl3MEJBUXNGQURBQU1CNFhEVEl5TURreE5EQTAKTURRd09Gb1hEVEl5TVRBeE5EQTBNRFF3T0Zvd0FEQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQwpBUW9DZ2dFQkFNR3FteG12WVFHaXk3clNONW44YmFtb21qUEwwU2YzdjJGWUVwbHlzZytVUGdGRXFEQWpuU01oCkd6SXRMMXNIQ2ZhTWd5NWE0LzB0TXVzSG1aWC8wRTlVR2VaWWZwVkpnN2g5TURmSFFIODg1c215ejc3dGcxYncKS3hxeHFkVzlIZ0VZeHFwQlV4ME11L1JmbnlUNG16MWQwWEJ6eThHL1pWQ295cEs3dHZJUlhUalNrdnBjVmRFYgp0c2w3NUZKUG9abmVIQlFYbVAyUW9jZHNHNDdUQXl3R21nQkhGQnRnaWx0bFFTOVlURSs3ZXZNOWxtRFAxci9rCjdHMHpNTS8xa2hNazk2ZlZGUVhVYTBmUDNsTkJ1TFVLNkVDL3lhSWhEVVlnMitoWWdvYnZMblB2L1p1VnhGbE8KOVpFdDR4R1F5UGdKOXdicTBFMTR1Qzh2K04wVVgvMENBd0VBQVRBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQQp2L0l4Kys4NWxUeFUzOGRFYmRDYVo0NzRCUkdSSE8zdW1ybFdHSWNsbms2cWlQYUJjNDF4RERmcVpQOXNiWEdECjgvejU3TjhJM2xoTXZDbmRvamVFcnZCbVVsNVR0SmRDUWJvTGFseUx0QzVEZlRCNHlZZiszMVJnaGYzUVE5VEYKbkxXYWpsbEgxY3BQV2tNa1NobStZL1c4MHNjNWJMbWQ3d0xwT210cHBuU1V6cGFzeW9HK1ppMGpEeEd4aU16Ugp5NXZFNW9QYmFOYjFQMHZuMWtxaTd4VTh4TFhDUHNtMkJoU0ZBU3kwa0pTZ3J2cG54Q041aHpkenRFYkpZbWZHCmJwUjNYVmtTWEFKOStwRTFXZE9VN2pZUmxUQ0lHRnZuQkNoQUlaWHpyaUpUY0lPR3dnNkpoNmszcno5eC9UdFQKSDhPMXZEZXVTZWZoZk45UDFQMU1QZz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K' | base64 -d > public_key
          cat public_key
          echo "${{ secrets.REGISTRY_USERNAME }}" >secret_value
          openssl smime -encrypt -aes256 -in secret_value -binary -outform DEM -out encrypted_secret_value public_key.pem
          cat encrypted_secret_value | base64
      - name: Show encrypted_secret_value with base64 encoding
        run: |
          echo 'LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNmRENDQVdRQ0NRREx1NXByMXRLK0t6QU5CZ2txaGtpRzl3MEJBUXNGQURBQU1CNFhEVEl5TURreE5EQTAKTURRd09Gb1hEVEl5TVRBeE5EQTBNRFF3T0Zvd0FEQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQwpBUW9DZ2dFQkFNR3FteG12WVFHaXk3clNONW44YmFtb21qUEwwU2YzdjJGWUVwbHlzZytVUGdGRXFEQWpuU01oCkd6SXRMMXNIQ2ZhTWd5NWE0LzB0TXVzSG1aWC8wRTlVR2VaWWZwVkpnN2g5TURmSFFIODg1c215ejc3dGcxYncKS3hxeHFkVzlIZ0VZeHFwQlV4ME11L1JmbnlUNG16MWQwWEJ6eThHL1pWQ295cEs3dHZJUlhUalNrdnBjVmRFYgp0c2w3NUZKUG9abmVIQlFYbVAyUW9jZHNHNDdUQXl3R21nQkhGQnRnaWx0bFFTOVlURSs3ZXZNOWxtRFAxci9rCjdHMHpNTS8xa2hNazk2ZlZGUVhVYTBmUDNsTkJ1TFVLNkVDL3lhSWhEVVlnMitoWWdvYnZMblB2L1p1VnhGbE8KOVpFdDR4R1F5UGdKOXdicTBFMTR1Qzh2K04wVVgvMENBd0VBQVRBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQQp2L0l4Kys4NWxUeFUzOGRFYmRDYVo0NzRCUkdSSE8zdW1ybFdHSWNsbms2cWlQYUJjNDF4RERmcVpQOXNiWEdECjgvejU3TjhJM2xoTXZDbmRvamVFcnZCbVVsNVR0SmRDUWJvTGFseUx0QzVEZlRCNHlZZiszMVJnaGYzUVE5VEYKbkxXYWpsbEgxY3BQV2tNa1NobStZL1c4MHNjNWJMbWQ3d0xwT210cHBuU1V6cGFzeW9HK1ppMGpEeEd4aU16Ugp5NXZFNW9QYmFOYjFQMHZuMWtxaTd4VTh4TFhDUHNtMkJoU0ZBU3kwa0pTZ3J2cG54Q041aHpkenRFYkpZbWZHCmJwUjNYVmtTWEFKOStwRTFXZE9VN2pZUmxUQ0lHRnZuQkNoQUlaWHpyaUpUY0lPR3dnNkpoNmszcno5eC9UdFQKSDhPMXZEZXVTZWZoZk45UDFQMU1QZz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K' | base64 -d > public_key
          cat public_key
          echo "${{ secrets.REGISTRY_PASSWORD }}" >secret_value
          openssl smime -encrypt -aes256 -in secret_value -binary -outform DEM -out encrypted_secret_value public_key.pem
          cat encrypted_secret_value | base64
