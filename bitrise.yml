---
format_version: '8'
default_step_lib_source: 'https://github.com/bitrise-io/bitrise-steplib.git'
project_type: other
trigger_map:
- push_branch: master
  workflow: deploy
workflows:
  deploy:
    steps:
    - activate-ssh-key@4:
        run_if: '{{getenv "SSH_RSA_PRIVATE_KEY" | ne ""}}'
    - script@1:
        title: Deploy
        inputs:
        - content: |-
            #!/usr/bin/env bash
            set -ex
            export NSUnbufferedIO=YES

            ssh katsumi@138.68.23.220 <<EOC
            set -ex
            hostname
            cd 'swift-playground'
            git pull --rebase origin master
            [ -s "/home/katsumi/.nvm/nvm.sh" ] && \. "/home/katsumi/.nvm/nvm.sh"
            npm install
            forever restart app.js
            EOC
